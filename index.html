<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Legal Text Parser</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 24px;
      background: #fafafa;
    }
    h1 { font-size: 22px; margin-bottom: 16px; }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    textarea {
      width: 100%;
      height: 420px;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid #ccc;
      resize: vertical;
    }
    pre {
      height: 420px;
      padding: 12px;
      background: #f2f2f2;
      border-radius: 12px;
      overflow: auto;
      font-size: 13px;
    }
    button {
      margin-top: 16px;
      padding: 10px 20px;
      border-radius: 10px;
      border: none;
      background: #000;
      color: #fff;
      cursor: pointer;
    }
    .badges { margin-top: 16px; }
    .badge {
      display: inline-block;
      background: #e5e5e5;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 13px;
      margin: 4px 6px 0 0;
    }
  </style>
</head>
<body>

<h1>⚖️ Legal Text Parser</h1>

<div class="grid">
  <textarea id="input" placeholder="Karar metnini buraya yapıştır…"></textarea>
  <pre id="output">JSON çıktısı</pre>
</div>

<button onclick="parseText()">Parse Et</button>

<div class="badges" id="badges"></div>

<script>
function detectDecisionType(text) {
  const rules = [
    { key: "ONAMA", regex: /\bONANMASINA\b/i },
    { key: "KISMEN ONAMA", regex: /\bKISMEN ONANMASINA\b/i },
    { key: "BOZMA", regex: /\bBOZULMASINA\b/i },
    { key: "KISMEN BOZMA", regex: /\bKISMEN BOZULMASINA\b/i },
    { key: "RED", regex: /\b(TEMYİZ İSTEĞİNİN REDDİ|REDDEDİLMESİNE)\b/i },
    { key: "USULDEN RET", regex: /\bUSULDEN REDDİ\b/i },
    { key: "DÜŞME", regex: /\bDÜŞMESİNE\b/i }
  ];
  for (const r of rules) if (r.regex.test(text)) return r.key;
  return "BELİRSİZ";
}

// === ANA FONKSİYON ===
// Tüm parser'ları buradan yönetiyoruz
function extractAllLegalInfo(text) {

  return {
    meta: {
      daire: text.match(/(\d+\.\s*Hukuk Dairesi)/i)?.[1] || null,
      esas: text.match(/(\d{4}\/\d+)\s*E\./i)?.[1] || null,
      karar: text.match(/(\d{4}\/\d+)\s*K\./i)?.[1] || null,
      mahkeme: text.match(/MAHKEMESİ\s*:\s*(.+)/i)?.[1]?.trim() || null,
      davaTuru: text.match(/DAVA TÜRÜ\s*:\s*(.+)/i)?.[1]?.trim() || null,
      kararTuru: detectDecisionType(text),
      tarih: text.match(/(\d{2}\.\d{2}\.\d{4})/)?.[1] || null
    }
  };
}

function parseText() {
  const input = document.getElementById("input").value;
  const result = extractAllLegalInfo(input);

  document.getElementById("output").textContent = JSON.stringify(result, null, 2);

  const badges = document.getElementById("badges");
  badges.innerHTML = "";

  for (const [k, v] of Object.entries(result.meta)) {
    if (!v) continue;
    const span = document.createElement("span");
    span.className = "badge";
    span.innerHTML = `<strong>${k}:</strong> ${v}`;
    badges.appendChild(span);
  }
}
</script>

</body>
</html>
